Creating test database for alias 'default'...
Found 117 test(s).
System check identified no issues (0 silenced).
...............EEEEEEEECould not parse VCF metadata with pysam: malformed header. Falling back to a text parser.
VCF import failed
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 37, in import_file
    with pysam.VariantFile(file_path) as vcf_in:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/codespace/.python/current/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/codespace/.python/current/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/codespace/.python/current/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
ValueError: malformed header

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/views.py", line 655, in form_valid
    created_group = importer.import_file(full_path)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 56, in import_file
    parse_vcf_text_fallback(file_path, sample_group, self.database_writer)
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_file_utils.py", line 74, in parse_vcf_text_fallback
    info_instance = writer.create_info_instance(info_mapping)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_database.py", line 336, in create_info_instance
    return Info.objects.create(payload=payload)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/query.py", line 677, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/base.py", line 567, in __init__
    raise TypeError(
TypeError: Info() got unexpected keyword arguments: 'payload'
F.EEUnsupported sequencing platform 'GalacticSeq'; storing raw metadata only.
[W::vcf_parse] Contig '4' is not defined in the header. (Quick workaround: index the file with tabix.)
[W::vcf_parse_info] INFO 'UNDECLARED' is not defined in the header, assuming Type=String
[W::vcf_parse_format] FORMAT 'XY' at 4:5555 is not defined in the header, assuming Type=String
ECould not parse VCF metadata with pysam: boom. Falling back to a text parser.
ECould not parse VCF metadata with pysam: malformed header. Falling back to a text parser.
E[W::vcf_parse] Contig '3' is not defined in the header. (Quick workaround: index the file with tabix.)
[W::vcf_parse_info] INFO 'MISSING' is not defined in the header, assuming Type=String
[W::vcf_parse_info] INFO 'UNDECLARED' is not defined in the header, assuming Type=String
[W::vcf_parse_format] FORMAT 'XY' at 3:7777 is not defined in the header, assuming Type=String
EEEEUnsupported metadata section 'SAMPLE_PLATFORM' encountered in the VCF header.
.Unsupported sequencing platform 'AlienSeq'; storing raw metadata only.
F[W::vcf_parse_format] FORMAT 'GT' at 1:2000 is not defined in the header, assuming Type=String
[W::vcf_parse_format] FORMAT 'GQ' at 1:2000 is not defined in the header, assuming Type=String
E.[W::vcf_parse] Contig '2' is not defined in the header. (Quick workaround: index the file with tabix.)
.Could not parse VCF metadata with pysam: fallback. Falling back to a text parser.
E......................VCF import failed
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/views.py", line 655, in form_valid
    created_group = importer.import_file(full_path)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/codespace/.python/current/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/codespace/.python/current/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/codespace/.python/current/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
ValueError: boom
...................F...................................
======================================================================
ERROR: test_create_format_instance_uses_field_map (app.tests.test_import_helpers.ImportHelpersTests.test_create_format_instance_uses_field_map)
Mapped FORMAT keys populate structured fields and extras remain JSON.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/tests/test_import_helpers.py", line 69, in test_create_format_instance_uses_field_map
    format_instance, sample_name = self.importer._create_format_instance(samples)
                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'VCFImporter' object has no attribute '_create_format_instance'

======================================================================
ERROR: test_create_info_instance_discards_placeholder_values (app.tests.test_import_helpers.ImportHelpersTests.test_create_info_instance_discards_placeholder_values)
Placeholder INFO values are stored as NULL instead of literal dots.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/tests/test_import_helpers.py", line 52, in test_create_info_instance_discards_placeholder_values
    info_instance = self.importer._create_info_instance(info_payload)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'VCFImporter' object has no attribute '_create_info_instance'

======================================================================
ERROR: test_create_info_instance_uses_field_map (app.tests.test_import_helpers.ImportHelpersTests.test_create_info_instance_uses_field_map)
Mapped INFO keys populate model fields and extras go to additional.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/tests/test_import_helpers.py", line 36, in test_create_info_instance_uses_field_map
    info_instance = self.importer._create_info_instance(info_payload)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'VCFImporter' object has no attribute '_create_info_instance'

======================================================================
ERROR: test_create_sample_group_recognizes_normalized_sample_headers (app.tests.test_import_helpers.ImportHelpersTests.test_create_sample_group_recognizes_normalized_sample_headers)
Sample group creation handles punctuation and camel-case header keys.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/tests/test_import_helpers.py", line 164, in test_create_sample_group_recognizes_normalized_sample_headers
    metadata = self.importer.extract_sample_group_metadata(mock_vcf)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'VCFImporter' object has no attribute 'extract_sample_group_metadata'

======================================================================
ERROR: test_extract_metadata_text_fallback_reads_sample_header (app.tests.test_import_helpers.ImportHelpersTests.test_extract_metadata_text_fallback_reads_sample_header)
Metadata extraction lowers keys, derives name, and stops at #CHROM.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/tests/test_import_helpers.py", line 94, in test_extract_metadata_text_fallback_reads_sample_header
    metadata = self.importer._extract_metadata_text_fallback(handle.name)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'VCFImporter' object has no attribute '_extract_metadata_text_fallback'

======================================================================
ERROR: test_extract_section_data_falls_back_to_section_value (app.tests.test_import_helpers.ImportHelpersTests.test_extract_section_data_falls_back_to_section_value)
Section-level metadata populates the configured primary field when needed.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/tests/test_import_helpers.py", line 130, in test_extract_section_data_falls_back_to_section_value
    section_data, consumed, additional = self.importer._extract_section_data(
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'VCFImporter' object has no attribute '_extract_section_data'

======================================================================
ERROR: test_extract_section_data_supports_hyphenated_keys (app.tests.test_import_helpers.ImportHelpersTests.test_extract_section_data_supports_hyphenated_keys)
Hyphenated section prefixes map fields and feed remaining into additional.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/tests/test_import_helpers.py", line 116, in test_extract_section_data_supports_hyphenated_keys
    section_data, consumed, additional = self.importer._extract_section_data(
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'VCFImporter' object has no attribute '_extract_section_data'

======================================================================
ERROR: test_export_respects_query_parameters (app.tests.test_integration_workflow.UserWorkflowIntegrationTests.test_export_respects_query_parameters)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/tests/test_integration_workflow.py", line 214, in test_export_respects_query_parameters
    sample_group = self._import_vcf()
                   ^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/tests/test_integration_workflow.py", line 76, in _import_vcf
    return self._import_vcf_content(self.WORKFLOW_VCF, "workflow_import.vcf")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/tests/test_integration_workflow.py", line 70, in _import_vcf_content
    sample_group = importer.import_file(str(path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 42, in import_file
    self._populate_sample_group_from_pysam(vcf_in, sample_group)
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 65, in _populate_sample_group_from_pysam
    info_instance = self.database_writer.create_info_instance(record.info)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_database.py", line 336, in create_info_instance
    return Info.objects.create(payload=payload)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/query.py", line 677, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/base.py", line 567, in __init__
    raise TypeError(
TypeError: Info() got unexpected keyword arguments: 'payload'

======================================================================
ERROR: test_search_filters_across_multiple_sample_groups (app.tests.test_integration_workflow.UserWorkflowIntegrationTests.test_search_filters_across_multiple_sample_groups)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/tests/test_integration_workflow.py", line 182, in test_search_filters_across_multiple_sample_groups
    first_group = self._import_vcf()
                  ^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/tests/test_integration_workflow.py", line 76, in _import_vcf
    return self._import_vcf_content(self.WORKFLOW_VCF, "workflow_import.vcf")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/tests/test_integration_workflow.py", line 70, in _import_vcf_content
    sample_group = importer.import_file(str(path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 42, in import_file
    self._populate_sample_group_from_pysam(vcf_in, sample_group)
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 65, in _populate_sample_group_from_pysam
    info_instance = self.database_writer.create_info_instance(record.info)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_database.py", line 336, in create_info_instance
    return Info.objects.create(payload=payload)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/query.py", line 677, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/base.py", line 567, in __init__
    raise TypeError(
TypeError: Info() got unexpected keyword arguments: 'payload'

======================================================================
ERROR: test_user_can_import_search_and_export_variants (app.tests.test_integration_workflow.UserWorkflowIntegrationTests.test_user_can_import_search_and_export_variants)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/tests/test_integration_workflow.py", line 79, in test_user_can_import_search_and_export_variants
    sample_group = self._import_vcf()
                   ^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/tests/test_integration_workflow.py", line 76, in _import_vcf
    return self._import_vcf_content(self.WORKFLOW_VCF, "workflow_import.vcf")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/tests/test_integration_workflow.py", line 70, in _import_vcf_content
    sample_group = importer.import_file(str(path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 42, in import_file
    self._populate_sample_group_from_pysam(vcf_in, sample_group)
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 65, in _populate_sample_group_from_pysam
    info_instance = self.database_writer.create_info_instance(record.info)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_database.py", line 336, in create_info_instance
    return Info.objects.create(payload=payload)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/query.py", line 677, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/base.py", line 567, in __init__
    raise TypeError(
TypeError: Info() got unexpected keyword arguments: 'payload'

======================================================================
ERROR: test_import_collects_warning_for_unsupported_platform_section (app.tests.test_vcf_importer.VCFImporterTests.test_import_collects_warning_for_unsupported_platform_section)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/tests/test_vcf_importer.py", line 332, in test_import_collects_warning_for_unsupported_platform_section
    importer, sample_group = self._import(
                             ^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/tests/test_vcf_importer.py", line 151, in _import
    sample_group = importer.import_file(str(path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 42, in import_file
    self._populate_sample_group_from_pysam(vcf_in, sample_group)
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 65, in _populate_sample_group_from_pysam
    info_instance = self.database_writer.create_info_instance(record.info)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_database.py", line 336, in create_info_instance
    return Info.objects.create(payload=payload)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/query.py", line 677, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/base.py", line 567, in __init__
    raise TypeError(
TypeError: Info() got unexpected keyword arguments: 'payload'

======================================================================
ERROR: test_import_falls_back_to_text_parser (app.tests.test_vcf_importer.VCFImporterTests.test_import_falls_back_to_text_parser)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 37, in import_file
    with pysam.VariantFile(file_path) as vcf_in:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/codespace/.python/current/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/codespace/.python/current/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/codespace/.python/current/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
OSError: boom

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/codespace/.python/current/lib/python3.12/unittest/mock.py", line 1387, in patched
    return func(*newargs, **newkeywargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/tests/test_vcf_importer.py", line 379, in test_import_falls_back_to_text_parser
    importer, sample_group = self._import(self.VCF_CONTENT)
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/tests/test_vcf_importer.py", line 151, in _import
    sample_group = importer.import_file(str(path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 56, in import_file
    parse_vcf_text_fallback(file_path, sample_group, self.database_writer)
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_file_utils.py", line 74, in parse_vcf_text_fallback
    info_instance = writer.create_info_instance(info_mapping)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_database.py", line 336, in create_info_instance
    return Info.objects.create(payload=payload)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/query.py", line 677, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/base.py", line 567, in __init__
    raise TypeError(
TypeError: Info() got unexpected keyword arguments: 'payload'

======================================================================
ERROR: test_import_handles_malformed_header_with_text_fallback (app.tests.test_vcf_importer.VCFImporterTests.test_import_handles_malformed_header_with_text_fallback)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 37, in import_file
    with pysam.VariantFile(file_path) as vcf_in:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/codespace/.python/current/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/codespace/.python/current/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/codespace/.python/current/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
ValueError: malformed header

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/codespace/.python/current/lib/python3.12/unittest/mock.py", line 1387, in patched
    return func(*newargs, **newkeywargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/tests/test_vcf_importer.py", line 398, in test_import_handles_malformed_header_with_text_fallback
    importer, sample_group = self._import(self.MALFORMED_HEADER_VCF, filename="malformed_header.vcf")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/tests/test_vcf_importer.py", line 151, in _import
    sample_group = importer.import_file(str(path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 56, in import_file
    parse_vcf_text_fallback(file_path, sample_group, self.database_writer)
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_file_utils.py", line 74, in parse_vcf_text_fallback
    info_instance = writer.create_info_instance(info_mapping)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_database.py", line 336, in create_info_instance
    return Info.objects.create(payload=payload)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/query.py", line 677, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/base.py", line 567, in __init__
    raise TypeError(
TypeError: Info() got unexpected keyword arguments: 'payload'

======================================================================
ERROR: test_import_handles_undefined_info_and_format_fields (app.tests.test_vcf_importer.VCFImporterTests.test_import_handles_undefined_info_and_format_fields)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/tests/test_vcf_importer.py", line 364, in test_import_handles_undefined_info_and_format_fields
    importer, sample_group = self._import(
                             ^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/tests/test_vcf_importer.py", line 151, in _import
    sample_group = importer.import_file(str(path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 42, in import_file
    self._populate_sample_group_from_pysam(vcf_in, sample_group)
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 65, in _populate_sample_group_from_pysam
    info_instance = self.database_writer.create_info_instance(record.info)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_database.py", line 336, in create_info_instance
    return Info.objects.create(payload=payload)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/query.py", line 677, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/base.py", line 567, in __init__
    raise TypeError(
TypeError: Info() got unexpected keyword arguments: 'payload'

======================================================================
ERROR: test_import_links_alleles_to_sample_group (app.tests.test_vcf_importer.VCFImporterTests.test_import_links_alleles_to_sample_group)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/tests/test_vcf_importer.py", line 155, in test_import_links_alleles_to_sample_group
    importer, sample_group = self._import(self.VCF_CONTENT)
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/tests/test_vcf_importer.py", line 151, in _import
    sample_group = importer.import_file(str(path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 42, in import_file
    self._populate_sample_group_from_pysam(vcf_in, sample_group)
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 65, in _populate_sample_group_from_pysam
    info_instance = self.database_writer.create_info_instance(record.info)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_database.py", line 336, in create_info_instance
    return Info.objects.create(payload=payload)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/query.py", line 677, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/base.py", line 567, in __init__
    raise TypeError(
TypeError: Info() got unexpected keyword arguments: 'payload'

======================================================================
ERROR: test_import_populates_related_metadata (app.tests.test_vcf_importer.VCFImporterTests.test_import_populates_related_metadata)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/tests/test_vcf_importer.py", line 190, in test_import_populates_related_metadata
    importer, sample_group = self._import(self.VCF_WITH_METADATA, filename="metadata.vcf")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/tests/test_vcf_importer.py", line 151, in _import
    sample_group = importer.import_file(str(path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 42, in import_file
    self._populate_sample_group_from_pysam(vcf_in, sample_group)
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 65, in _populate_sample_group_from_pysam
    info_instance = self.database_writer.create_info_instance(record.info)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_database.py", line 336, in create_info_instance
    return Info.objects.create(payload=payload)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/query.py", line 677, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/base.py", line 567, in __init__
    raise TypeError(
TypeError: Info() got unexpected keyword arguments: 'payload'

======================================================================
ERROR: test_import_preserves_custom_sample_metadata (app.tests.test_vcf_importer.VCFImporterTests.test_import_preserves_custom_sample_metadata)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/tests/test_vcf_importer.py", line 184, in test_import_preserves_custom_sample_metadata
    importer, sample_group = self._import(self.VCF_CONTENT, filename="custom_metadata.vcf")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/tests/test_vcf_importer.py", line 151, in _import
    sample_group = importer.import_file(str(path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 42, in import_file
    self._populate_sample_group_from_pysam(vcf_in, sample_group)
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 65, in _populate_sample_group_from_pysam
    info_instance = self.database_writer.create_info_instance(record.info)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_database.py", line 336, in create_info_instance
    return Info.objects.create(payload=payload)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/query.py", line 677, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/base.py", line 567, in __init__
    raise TypeError(
TypeError: Info() got unexpected keyword arguments: 'payload'

======================================================================
ERROR: test_import_routes_common_info_fields_to_columns (app.tests.test_vcf_importer.VCFImporterTests.test_import_routes_common_info_fields_to_columns)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/tests/test_vcf_importer.py", line 173, in test_import_routes_common_info_fields_to_columns
    importer, _ = self._import(self.VCF_WITH_COMMON_INFO_FIELDS, filename="info_fields.vcf")
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/tests/test_vcf_importer.py", line 151, in _import
    sample_group = importer.import_file(str(path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 42, in import_file
    self._populate_sample_group_from_pysam(vcf_in, sample_group)
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 65, in _populate_sample_group_from_pysam
    info_instance = self.database_writer.create_info_instance(record.info)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_database.py", line 336, in create_info_instance
    return Info.objects.create(payload=payload)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/query.py", line 677, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/base.py", line 567, in __init__
    raise TypeError(
TypeError: Info() got unexpected keyword arguments: 'payload'

======================================================================
ERROR: test_text_fallback_preserves_json_metadata (app.tests.test_vcf_importer.VCFImporterTests.test_text_fallback_preserves_json_metadata)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 37, in import_file
    with pysam.VariantFile(file_path) as vcf_in:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/codespace/.python/current/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/codespace/.python/current/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/codespace/.python/current/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
OSError: fallback

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/codespace/.python/current/lib/python3.12/unittest/mock.py", line 1387, in patched
    return func(*newargs, **newkeywargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/tests/test_vcf_importer.py", line 414, in test_text_fallback_preserves_json_metadata
    importer, sample_group = self._import(self.FALLBACK_JSON_METADATA_VCF, filename="fallback_json.vcf")
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/tests/test_vcf_importer.py", line 151, in _import
    sample_group = importer.import_file(str(path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_importer.py", line 56, in import_file
    parse_vcf_text_fallback(file_path, sample_group, self.database_writer)
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_file_utils.py", line 74, in parse_vcf_text_fallback
    info_instance = writer.create_info_instance(info_mapping)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/MetaGap/app/services/vcf_database.py", line 336, in create_info_instance
    return Info.objects.create(payload=payload)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/query.py", line 677, in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/MetaGap/.venv/lib/python3.12/site-packages/django/db/models/base.py", line 567, in __init__
    raise TypeError(
TypeError: Info() got unexpected keyword arguments: 'payload'

======================================================================
FAIL: test_import_with_warning_feedback_during_onboarding (app.tests.test_integration_workflow.UserWorkflowIntegrationTests.test_import_with_warning_feedback_during_onboarding)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/tests/test_integration_workflow.py", line 168, in test_import_with_warning_feedback_during_onboarding
    self.assertTrue(
AssertionError: False is not true : Successful import should trigger a confirmation message.

======================================================================
FAIL: test_import_records_unhandled_sample_metadata (app.tests.test_vcf_importer.VCFImporterTests.test_import_records_unhandled_sample_metadata)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/tests/test_vcf_importer.py", line 309, in test_import_records_unhandled_sample_metadata
    self.assertEqual(
AssertionError: None != 'AlienSeq'

======================================================================
FAIL: test_import_view_uses_correct_form_setup (app.tests.test_views_sample_group_access.SampleGroupViewAccessMatrixTests.test_import_view_uses_correct_form_setup)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/workspaces/MetaGap/MetaGap/app/tests/test_views_sample_group_access.py", line 66, in test_import_view_uses_correct_form_setup
    self.assertEqual(response.context.get("form_action"), reverse("import_data"))
AssertionError: None != '/import/'

----------------------------------------------------------------------
Ran 117 tests in 48.927s

FAILED (failures=3, errors=19)
Destroying test database for alias 'default'...
